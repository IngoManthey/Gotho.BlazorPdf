@inherits ComponentBase

<div class="blazorpdf-container">
    <div role="toolbar" class="blazorpdf-toolbar">
        @*Toggle Thumbnail*@
        <div class="blazorpdf-toolbar__item">
            <button class="blazorpdf-toolbar__item-button" disabled="@Loading" @onclick="ToggleThumbnails"
                    aria-label="Toggle Thumbnails">
                <span>
                    <svg class="blazorpdf-toolbar__svg">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path
                            d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\"/>
                    </svg>
                </span>
            </button>
        </div>

        @*Previous Page*@
        <div class="blazorpdf-toolbar__item">
            <button class="blazorpdf-toolbar__item-button" disabled="@Loading" @onclick="PreviousPageAsync"
                    aria-label="Previous Page">
                <span>
                    <svg class="blazorpdf-toolbar__svg">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path
                            d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\"/>
                    </svg>
                </span>
            </button>
        </div>

        @*Next Page*@
        <div class="blazorpdf-toolbar__item">
            <button class="blazorpdf-toolbar__item-button" disabled="@Loading" @onclick="NextPageAsync"
                    aria-label="Next Page">
                <span>
                    <svg class="blazorpdf-toolbar__svg">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path
                            d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\"/>
                    </svg>
                </span>
            </button>
        </div>

        @*Current Page*@
        <div class="blazorpdf-toolbar__item">
            <input type="number" value="@PdfFile.Paging.CurrentPage" @onchange="PageChanged"/>
        </div>

        @* of *@
        <div class="blazorpdf-toolbar__item">
            <p>of</p>
        </div>

        @*Page Total*@
        <div class="blazorpdf-toolbar__item">
            <p>@PdfFile.Paging.TotalPages</p>
        </div>

        <div class="blazorpdf-toolbar__spacer"></div>

        @*Zoom Out*@
        <div class="blazorpdf-toolbar__item">
            <button class="blazorpdf-toolbar__item-button" @onclick="ZoomOutAsync" aria-label="Zoom Out">
                <span>
                    <svg class="blazorpdf-toolbar__svg">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path
                            d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\"/>
                    </svg>
                </span>
            </button>
        </div>

        @*Current Zoom*@
        <div class="blazorpdf-toolbar__item">
            <span class="blazorpdf-toolbar__item-chip">@PdfFile.Zooming.GetZoomPercentageString()</span>
        </div>

        @*Zoom In*@
        <div class="blazorpdf-toolbar__item">
            <button class="blazorpdf-toolbar__item-button" @onclick="ZoomInAsync" aria-label="Zoom In">
                <span>
                    <svg class="blazorpdf-toolbar__svg">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path
                            d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\"/>
                    </svg>
                </span>
            </button>
        </div>

        <div class="blazorpdf-toolbar__spacer"></div>

        @*Menu*@
        <div class="blazorpdf-toolbar__item">
            <div class="blazorpdf-toolbar__menu-wrapper">
                <input type="checkbox" id="menu-toggle" hidden>
                <label for="menu-toggle" class="blazorpdf-toolbar__menu-trigger-button">
                  <span>
                    <svg class="blazorpdf-toolbar__svg">
                      <path d="M0 0h24v24H0z" fill="none"/>
                      <path
                          d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                    </svg>
                  </span>
                </label>
                <div class="blazorpdf-toolbar__menu">
                    <!-- Clicking the overlay closes the menu -->
                    <label for="menu-toggle" class="blazorpdf-toolbar__menu-overlay"></label>
                    <div class="blazorpdf-toolbar__menu-content">
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="RotateClockwiseAsync">
                            <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">Rotate Clockwise</span>
                        </button>
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="RotateCounterclockwiseAsync">
                             <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">Rotate Counterclockwise</span>
                        </button>
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="SwitchOrientationAsync">
                             <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">Switch Orientation</span>
                        </button>
                        <hr class="blazorpdf-toolbar__menu-divider">
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="FirstPageAsync">
                             <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">First Page</span>
                        </button>
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="LastPageAsync">
                             <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">Last Page</span>
                        </button>
                        <hr class="blazorpdf-toolbar__menu-divider">
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="ResetZoomAsync">
                             <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">Reset Zoom</span>
                        </button>
                        <hr class="blazorpdf-toolbar__menu-divider">
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="PrintDocumentAsync">
                             <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">Print Document</span>
                        </button>
                        <button type="button" class="blazorpdf-toolbar__menu-menu-item" @onclick="DownloadDocumentAsync">
                             <span class="blazorpdf-toolbar__menu-menu-item-icon">
                                <svg class="blazorpdf-toolbar__svg">
                                  <path d="M0 0h24v24H0z" fill="none"/>
                                  <path
                                      d="M22 5.72l-4.6-3.86-1.29 1.53 4.6 3.86L22 5.72zM7.88 3.39L6.6 1.86 2 5.71l1.29 1.53 4.59-3.85zM12.5 8H11v6l4.75 2.85.75-1.23-4-2.37V8zM12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9c4.97 0 9-4.03 9-9s-4.03-9-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                                </svg>
                            </span>
                            <span class="blazorpdf-toolbar__menu-menu-item-text">Download Document</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="blazorpdf-pdf">
        @if (Error is not null)
        {
            <div class="blazorpdf-pdf__error">
                <div class="blazorpdf-pdf__error-content">
                    @if (Error.ErrorType == PdfErrorType.PasswordRequired)
                    {
                        <h1>⚠ Password Required</h1>
                        <div class="blazorpdf-pdf__input">
                            <input type="text" @bind="PdfPassword" id="pdfPassword" class="blazorpdf-pdf__input-field"
                                   placeholder="Password">
                            <span
                                class="blazorpdf-pdf__input-help">Please enter the password for the PDF document</span>
                        </div>
                        <button class="blazorpdf-pdf__error-submit" type="button" @onclick="ReloadPdfAsync">Submit
                        </button>
                    }
                </div>
            </div>
        }

        <div class="@(Error is not null ? "blazorpdf-d-none" : "")" style="margin: auto">
            <div id="@($"{PdfFile.Id}_thumbs")"
                 class="@(_showThumbnails ? "blazorpdf-pdf__thumbnails" : "blazorpdf-pdf__thumbnails blazorpdf-d-none")"></div>
            <div class="blazorpdf-pdf__pdf-container">
                <canvas @ref="Element" id="@PdfFile.Id"></canvas>
                <div id="@($"{PdfFile.Id}_text")" class="textLayer"></div>
            </div>
        </div>
    </div>
</div>

@code {

    private bool _showThumbnails = true;

    private bool InputDisabled()
    {
        return Loading || Error is not null;
    }

    private void ToggleThumbnails()
    {
        _showThumbnails = !_showThumbnails;
    }

    private async Task PageChanged(ChangeEventArgs obj)
    {
        if (int.TryParse(obj.Value as string, out var result))
        {
            await PageNumberChanged(result);
        }
    }

}